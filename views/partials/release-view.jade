div(ng-show="release")
  h1 {{release.name}}
  a(href='/release/{{release.$id}}/edit', class="btn btn-primary") Edit
  p Release date: {{ release.releaseDate | date:'fullDate'  }}
  div
    | Tickets in release: {{release.tickets.length}}
  hr
  button(ng-click='openTicketModal()') Add Ticket
  div(ng-repeat='ticket in release.tickets')
    h2
      a(href='http://phab.dev.ebuyer.com/{{ticket.ticketId}}') {{ticket.ticketId}}
      &nbsp;{{ticket.description.dev}}
    | &nbsp;{{ticket.owner}}
    br
    span(ng-show='ticket.description.business') {{ticket.description.business}}
    h3 Diffs - {{ticket.diffs.length}}
    form(
      class='form-horizontal',
      novalidate
      ng-submit='addDiff(this, ticket)'
    )
      label(class='control-label col-sm-2') Phabricator Diff
      div(class='col-sm-10')
        input(
          type='text',
          class='form-control',
          placeholder='D####',
          required,
          ng-model='diffId'
        )
      button(
        type='submit',
        class='btn btn-default'
        ng-disabled='create.$invalid'
      ) Add Diff

    div(ng-repeat='diff in ticket.diffs')
      a(href='http://phab.dev.ebuyer.com/{{diff.diffId}}') {{diff.diffId}}
      |  - {{diff.repo}}
    hr
div(ng-hide="release")
  h1 This release doesn't exist
script(
  type='text/ng-template',
  id='add-ticket.html'
  )
    div(class='modal-header')
      h3(class='modal-title') Add Ticket

    div(class='modal-body')
      form(
        class='form-horizontal',
        name='addTicket',
        novalidate,
        ng-submit='submit(addTicket.$valid)'
      )
        div(class='form-group')
          label(class='control-label col-sm-2') Phabricator Ticket
          div(class='col-sm-10')
            input(
              type='text',
              class='form-control',
              placeholder='T####',
              required,
              ng-model='newTicket.ticketId'
            )
        div(class='form-group')
          label(class='control-label col-sm-2') Dev Description
          div(class='col-sm-10')
            input(
              type='text',
              class='form-control',
              ng-model='newTicket.description.dev'
            )
        button(
          type='submit',
          class='btn btn-default'
          ng-disabled='create.$invalid'
        ) Add ticket
    div(class='modal-footer')
      button(class='btn btn-primary', type='button', ng-click='ok()') OK
      button(class='btn btn-warning', type='button', ng-click='cancel()') Cancel
